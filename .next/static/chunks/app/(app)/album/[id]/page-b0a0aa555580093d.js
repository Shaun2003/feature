(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9511],{3877:(e,t,i)=>{Promise.resolve().then(i.bind(i,8488))},4474:(e,t,i)=>{"use strict";i.d(t,{$:()=>l});var r=i(95155);i(12115);var a=i(42442),s=i(18460),n=i(91337);let o=(0,s.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function l({className:e,variant:t,size:i,asChild:s=!1,...l}){let d=s?a.DX:"button";return(0,r.jsx)(d,{"data-slot":"button",className:(0,n.cn)(o({variant:t,size:i,className:e})),...l})}},8488:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>v});var r=i(95155),a=i(12115),s=i(73321),n=i(80723),o=i(34152),l=i(20232),d=i(6962),c=i(53810),u=i(4474),p=i(23511),h=i(43928),m=i(46400),f=i(41693),w=i(94674),g=i(81890);function v(){let e=(0,s.useRouter)(),t=(0,s.useParams)().id,{toast:i}=(0,g.d)(),{playQueue:v,currentSong:b,isPlaying:y,togglePlayPause:x}=(0,m.F)(),[S,k]=(0,a.useState)(null),[T,j]=(0,a.useState)([]),[$,D]=(0,a.useState)(!0),[N,A]=(0,a.useState)(new Set),[E,P]=(0,a.useState)(new Set);(0,a.useEffect)(()=>{async function e(){D(!0);try{let e=await (0,h.getPlaylistItems)(t);j(e),e.length>0&&k({id:t,title:`Album - ${e[0].artist||"Unknown"}`,description:`${e.length} songs`,thumbnail:e[0].thumbnail,channelTitle:e[0].channelTitle,itemCount:e.length});let i=new Set;for(let t of e)await (0,w.hS)(t.id)&&i.add(t.id);P(i)}catch(e){console.error("[v0] Error loading album:",e),i({title:"Error",description:"Failed to load album. Please try again.",variant:"destructive"})}finally{D(!1)}}t&&e()},[t,i]);let I=async e=>{if(E.has(e.id))return void i({title:"Already Downloaded",description:"This track is already in your library."});A(t=>new Set(t).add(e.id));try{await (0,w.UB)(e,t=>{console.log(`[v0] Download progress for ${e.id}: ${t}%`)}),P(t=>new Set(t).add(e.id)),i({title:"Success",description:`"${e.title}" downloaded successfully!`})}catch(t){console.error("[v0] Download error:",t),i({title:"Download Failed",description:`Failed to download "${e.title}". Try again later.`,variant:"destructive"})}finally{A(t=>{let i=new Set(t);return i.delete(e.id),i})}},_=async()=>{let e=T.filter(e=>!E.has(e.id));if(0===e.length)return void i({title:"Already Downloaded",description:"All tracks in this album are already downloaded."});A(new Set(e.map(e=>e.id)));let t=0,r=0;for(let i of e)try{await (0,w.UB)(i),t++,P(e=>new Set(e).add(i.id))}catch(e){r++,console.error(`[v0] Failed to download ${i.id}:`,e)}A(new Set),0===r?i({title:"Success",description:`Downloaded ${t} track(s)!`}):i({title:"Partial Download",description:`Downloaded ${t}, failed ${r}. Try again later.`,variant:"destructive"})},C=async()=>{if(S)try{await navigator.share({title:S.title,text:`Check out this album: ${S.title}`,url:window.location.href})}catch(e){"AbortError"!==e.name&&(await navigator.clipboard.writeText(window.location.href),i({title:"Link Copied",description:"Album link copied to clipboard!"}))}};return $?(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(p.E,{className:"h-8 w-12"}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(p.E,{className:"h-48 w-full rounded-lg"}),(0,r.jsx)(p.E,{className:"h-8 w-1/3"}),(0,r.jsx)(p.E,{className:"h-4 w-1/4"})]})]}),(0,r.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,r.jsx)(p.E,{className:"h-16 w-full rounded"},t))})]}):S?(0,r.jsxs)("div",{className:"space-y-8",children:[(0,r.jsxs)("button",{onClick:()=>e.back(),className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors",children:[(0,r.jsx)(n.A,{className:"w-4 h-4"}),"Back"]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"relative h-64 rounded-lg overflow-hidden bg-gradient-to-br from-purple-500 to-blue-600",children:[S.thumbnail&&(0,r.jsx)("img",{src:S.thumbnail,alt:S.title,className:"w-full h-full object-cover opacity-60"}),(0,r.jsxs)("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex flex-col justify-end p-6",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:S.title}),(0,r.jsx)("p",{className:"text-sm text-gray-200",children:S.channelTitle}),(0,r.jsx)("p",{className:"text-xs text-gray-300 mt-1",children:S.description})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-3 md:gap-4",children:[(0,r.jsx)(u.$,{onClick:()=>{y&&b?.id===T[0]?.id?x():T.length>0&&v(T)},size:"lg",className:"bg-green-600 hover:bg-green-700 text-white",children:y&&b?.id===T[0]?.id?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{className:"w-5 h-5 mr-2"}),"Pause"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(l.A,{className:"w-5 h-5 mr-2"}),"Play All"]})}),(0,r.jsxs)(u.$,{onClick:_,variant:"outline",size:"lg",disabled:N.size>0,children:[(0,r.jsx)(d.A,{className:"w-5 h-5 mr-2"}),E.size===T.length?"Downloaded":"Download All"]}),(0,r.jsxs)(u.$,{onClick:C,variant:"outline",size:"lg",children:[(0,r.jsx)(c.A,{className:"w-5 h-5 mr-2"}),"Share"]})]})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("h2",{className:"text-xl font-semibold text-foreground",children:["Tracks (",T.length,")"]}),(0,r.jsx)("div",{className:"space-y-1",children:T.map((e,t)=>(0,r.jsx)(f.O,{track:e,index:t+1,isDownloaded:E.has(e.id),isDownloading:N.has(e.id),onDownloadClick:()=>I(e)},e.id))})]})]}):(0,r.jsxs)("div",{className:"text-center space-y-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Album Not Found"}),(0,r.jsx)(u.$,{onClick:()=>e.back(),children:"Go Back"})]})}},23511:(e,t,i)=>{"use strict";i.d(t,{E:()=>s});var r=i(95155),a=i(91337);function s({className:e,...t}){return(0,r.jsx)("div",{"data-slot":"skeleton",className:(0,a.cn)("bg-accent animate-pulse rounded-md",e),...t})}},41693:(e,t,i)=>{"use strict";i.d(t,{O:()=>o});var r=i(95155),a=i(37206),s=i(12115);let n=(0,a.default)(()=>Promise.all([i.e(9338),i.e(1300),i.e(8349),i.e(1018),i.e(1886),i.e(3623),i.e(6917),i.e(9619)]).then(i.bind(i,19619)).then(e=>e.TrackRowClient),{loadableGenerated:{webpack:()=>[19619]},ssr:!1}),o=(0,s.memo)(function(e){return(0,r.jsx)(n,{...e})})},43928:(e,t,i)=>{"use strict";i.d(t,{XB:()=>m,getPlaylistItems:()=>u,Pd:()=>c,K0:()=>l,eZ:()=>d});class r{get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}set(e,t,i=this.DEFAULT_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:i})}clear(){this.cache.clear()}clearOldEntries(e=this.DEFAULT_TTL){let t=Date.now();for(let[i,r]of this.cache.entries())t-r.timestamp>e&&this.cache.delete(i)}constructor(){this.cache=new Map,this.DEFAULT_TTL=3e5}}let a=new r;function s(e,t){let i=new URLSearchParams(Object.entries(t).reduce((e,[t,i])=>(null!=i&&(e[t]=String(i)),e),{})).toString();return`${e}?${i}`}let n="AIzaSyCpbcqf4WZxq7UVJUZ-XVO7qTFpBeJE0kI",o="https://www.googleapis.com/youtube/v3";function l(e){if(!e||"string"!=typeof e)return!1;let t=e.trim();return/^[a-zA-Z0-9_-]{11}$/.test(t)}async function d(e,t){if(!n)return console.error("[v0] YouTube API key not configured"),{videos:[],playlists:[]};try{let i=s("search-youtube",{query:e});if(!t){let t=a.get(i);if(t)return console.log("[v0] Search cache hit:",e),t}let r=new URLSearchParams({part:"snippet",q:`${e} official audio`,type:"video,playlist",maxResults:"20",key:n});t&&r.append("pageToken",t);let d=await fetch(`${o}/search?${r.toString()}`);if(!d.ok)throw Error(`YouTube search failed: ${d.status}`);let c=await d.json(),u=c.items.filter(e=>"youtube#video"===e.id.kind),m=c.items.filter(e=>"youtube#playlist"===e.id.kind),f=u.map(e=>e.id.videoId).join(","),w=m.map(e=>({id:e.id.playlistId,title:e.snippet.title,description:e.snippet.description,thumbnail:e.snippet.thumbnails.high?.url||"",channelTitle:e.snippet.channelTitle})),g=[];if(f){let e=await fetch(`${o}/videos?part=contentDetails,snippet&id=${f}&key=${n}`);if(!e.ok)throw Error(`YouTube details failed: ${e.status}`);let t=(await e.json()).items.map(e=>{if(!l(e.id))return console.warn("[v0] Skipping video with invalid ID format:",e.id),null;let t=e.snippet.title,i=e.snippet.channelTitle,r=i;return t.includes(" - ")?r=t.split(" - ")[0].trim():t.includes(" | ")&&(r=t.split(" | ")[0].trim()),{id:e.id,title:p(t),artist:r,thumbnail:e.snippet.thumbnails.high?.url||"",duration:h(e.contentDetails.duration),channelTitle:i}});g.push(...t.filter(e=>null!==e))}let v={videos:g,playlists:w,nextPageToken:c.nextPageToken};return t||a.set(i,v),v}catch(e){return console.error("[v0] YouTube search error:",e),{videos:[],playlists:[]}}}async function c(){if(!n)return[];try{let e="trending-music",t=a.get(e);if(t)return console.log("[v0] Trending cache hit"),t;let i=await fetch(`${o}/videos?part=snippet,contentDetails&chart=mostPopular&regionCode=US&videoCategoryId=10&maxResults=20&key=${n}`);if(!i.ok)throw Error(`YouTube trending failed: ${i.status}`);let r=(await i.json()).items.map(e=>{let t=e.snippet.title,i=e.snippet.channelTitle,r=i;return t.includes(" - ")&&(r=t.split(" - ")[0].trim()),{id:e.id,title:p(t),artist:r,thumbnail:e.snippet.thumbnails.high?.url||"",duration:h(e.contentDetails.duration),channelTitle:i}});return a.set(e,r,36e5),r}catch(e){return console.error("[v0] YouTube trending error:",e),[]}}async function u(e,t=20){if(!n)return[];try{let i=s("playlist-items",{playlistId:e,maxResults:t}),r=a.get(i);if(r)return console.log("[v0] Playlist cache hit:",e),r;let d=await fetch(`${o}/playlistItems?part=snippet,contentDetails&playlistId=${e}&maxResults=${t}&key=${n}`);if(!d.ok)throw Error(`YouTube playlist failed: ${d.status}`);let c=(await d.json()).items.map(e=>e.contentDetails.videoId).join(",");if(!c)return[];let u=await fetch(`${o}/videos?part=contentDetails,snippet&id=${c}&key=${n}`);if(!u.ok)throw Error(`YouTube video details failed: ${u.status}`);return(await u.json()).items.map(e=>{if(!l(e.id))return console.warn("[v0] Skipping playlist item with invalid ID format:",e.id),null;let t=e.snippet.title,i=e.snippet.channelTitle,r=i;return t.includes(" - ")&&(r=t.split(" - ")[0].trim()),{id:e.id,title:p(t),artist:r,thumbnail:e.snippet.thumbnails.high?.url||"",duration:h(e.contentDetails.duration),channelTitle:i}}).filter(e=>null!==e)}catch(e){return console.error("[v0] YouTube playlist error:",e),[]}}function p(e){return e.replace(/\(Official\s*(Music\s*)?Video\)/gi,"").replace(/\[Official\s*(Music\s*)?Video\]/gi,"").replace(/\(Official\s*Audio\)/gi,"").replace(/\[Official\s*Audio\]/gi,"").replace(/\(Lyrics?\)/gi,"").replace(/\[Lyrics?\]/gi,"").replace(/\(Audio\)/gi,"").replace(/\[Audio\]/gi,"").replace(/\|.*$/g,"").replace(/\s+-\s+[^-]+$/,"").trim()}function h(e){let t=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!t)return"0:00";let i=parseInt(t[1]||"0"),r=parseInt(t[2]||"0"),a=parseInt(t[3]||"0");return i>0?`${i}:${r.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${r}:${a.toString().padStart(2,"0")}`}function m(e){let t=e.split(":").map(Number);return 3===t.length?3600*t[0]+60*t[1]+t[2]:60*t[0]+(t[1]||0)}},46400:(e,t,i)=>{"use strict";i.d(t,{F:()=>s,T:()=>a});var r=i(12115);let a=(0,r.createContext)(void 0);function s(){let e=(0,r.useContext)(a);if(void 0===e)throw Error("usePlayer must be used within a PlayerProvider");return e}},54614:(e,t,i)=>{"use strict";i.d(t,{$o:()=>o,ToastProvider:()=>l});var r=i(95155),a=i(12115);let s=new Map,n=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:i}=t;return{...e,toasts:e.toasts.map(e=>e.id===i||void 0===i?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)};default:return e}},o=a.createContext(void 0),l=({children:e})=>{let[t,i]=a.useReducer(n,{toasts:[]});return a.useEffect(()=>{t.toasts.forEach(e=>{!1===e.open&&((e,t)=>{if(s.has(e))return;let i=setTimeout(()=>{s.delete(e),t({type:"REMOVE_TOAST",toastId:e})},1e6);s.set(e,i)})(e.id,i)})},[t.toasts]),(0,r.jsx)(o.Provider,{value:{state:t,dispatch:i},children:e})}},81890:(e,t,i)=>{"use strict";i.d(t,{d:()=>n});var r=i(12115),a=i(54614);let s=0;function n(){let e=r.useContext(a.$o);if(!e)throw Error("useToast must be used within a ToastProvider");let{state:t,dispatch:i}=e,n=r.useCallback(({...e})=>{let t=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>i({type:"DISMISS_TOAST",toastId:t});return i({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||r()}}}),{id:t,dismiss:r}},[i]);return{...t,toast:n,dismiss:e=>i({type:"DISMISS_TOAST",toastId:e})}}},91337:(e,t,i)=>{"use strict";i.d(t,{cn:()=>s});var r=i(29722),a=i(622);function s(...e){return(0,a.QP)((0,r.$)(e))}},94674:(e,t,i)=>{"use strict";i.d(t,{BB:()=>d,UB:()=>n,WR:()=>o,hS:()=>l});var r=i(43928);let a=null;async function s(){return a||new Promise((e,t)=>{let i=indexedDB.open("pulse-music-db",2);i.onerror=()=>t(i.error),i.onsuccess=()=>{e(a=i.result)}})}async function n(e,t){let i=(await s()).transaction("downloads","readwrite").objectStore("downloads"),r={...e,downloadedAt:Date.now(),downloadStatus:"downloading",downloadProgress:0};i.put(r);try{t?.(10),e.id,r.audioUrl=`https://www.youtube.com/watch?v=${e.id}`,r.downloadStatus="completed",r.downloadProgress=100,t?.(50),i.put(r),t?.(100),console.log(`[v0] Downloaded track: ${e.title}`)}catch(t){throw console.error(`[v0] Download error for ${e.id}:`,t),r.downloadStatus="failed",i.put(r),Error(`Failed to download ${e.title}`)}}async function o(){let e=(await s()).transaction("downloads","readonly").objectStore("downloads").index("downloadStatus");return new Promise((t,i)=>{let a=e.openCursor(IDBKeyRange.only("completed"),"prev"),s=[];a.onsuccess=e=>{let i=e.target.result;if(i){let e=i.value;(0,r.K0)(e.id)?s.push(e):console.warn("[v0] Skipping downloaded track with invalid ID:",e.id),i.continue()}else t(s)},a.onerror=()=>i(a.error)})}async function l(e){let t=(await s()).transaction("downloads","readonly").objectStore("downloads");return new Promise((i,r)=>{let a=t.get(e);a.onsuccess=()=>{let e=a.result;i(!!e&&"completed"===e.downloadStatus)},a.onerror=()=>r(a.error)})}async function d(e){let t=(await s()).transaction("downloads","readwrite").objectStore("downloads");return new Promise((i,r)=>{let a=t.delete(e);a.onsuccess=()=>{console.log(`[v0] Deleted downloaded track: ${e}`),i()},a.onerror=()=>{console.error("[v0] Failed to delete downloaded track:",a.error),r(a.error)}})}}},e=>{e.O(0,[6679,6812,8441,3794,7358],()=>e(e.s=3877)),_N_E=e.O()}]);