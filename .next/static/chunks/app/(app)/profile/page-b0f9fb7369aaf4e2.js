(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[101],{3582:(e,t,s)=>{"use strict";s.d(t,{ProfileContent:()=>$});var a=s(95155),r=s(95885),i=s(79984),l=s(4474),n=s(24683),c=s(15306),d=s(70460),o=s(73321),m=s(51900),u=s(36999),x=s(7686),h=s(10029),g=s(47149),f=s(84980),v=s(89123),p=s(94928),j=s(7810),y=s(89363),b=s(41313),N=s(11951),w=s(12115),k=s(7236),_=s(81890),A=s(76537),S=s(30783);async function T(e){try{let{data:{user:t}}=await k.N.auth.getUser(),s=e||t?.id;if(!s)return[];let{data:a,error:r}=await k.N.from("activity_feed").select("*").eq("user_id",s).order("created_at",{ascending:!1}).limit(20);if(r)throw r;return a?.map(e=>({id:e.id,userId:e.user_id,userName:e.activity_data&&"object"==typeof e.activity_data?e.activity_data.user_name:"Unknown User",activityType:e.activity_type,activityData:e.activity_data,createdAt:e.created_at}))||[]}catch(e){return console.error("[Social] Error getting activity feed:",e),[]}}var I=s(40245),D=s(57684),E=s(6296),C=s(91337),O=s(41177);function z({userId:e,className:t}){let[s,r]=(0,w.useState)([]),[i,l]=(0,w.useState)(!0);return((0,w.useEffect)(()=>{!async function(){l(!0);try{let t=await T(e);r(t)}catch(e){console.error("Error loading activity feed:",e)}finally{l(!1)}}()},[e]),i)?(0,a.jsx)("div",{className:(0,C.cn)("flex items-center justify-center py-8",t),children:(0,a.jsx)(E.A,{className:"w-6 h-6 animate-spin text-muted-foreground"})}):0===s.length?(0,a.jsxs)("div",{className:(0,C.cn)("text-center py-8",t),children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"No recent activity"}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs mt-1",children:"Start listening, creating playlists, and connecting with others"})]}):(0,a.jsx)("div",{className:(0,C.cn)("space-y-3",t),children:s.map(e=>{let t=(e=>{switch(e){case"liked_track":return x.A;case"created_playlist":return I.A;case"followed_user":return D.A;default:return h.A}})(e.activityType),s=(e=>{switch(e){case"liked_track":return"text-red-500 bg-red-500/10";case"created_playlist":return"text-blue-500 bg-blue-500/10";case"followed_user":return"text-primary bg-primary/10";case"added_to_playlist":return"text-orange-500 bg-orange-500/10";default:return"text-muted-foreground bg-secondary"}})(e.activityType);return(0,a.jsxs)("div",{className:"flex items-start gap-3 p-3 rounded-lg hover:bg-card/60 transition-colors",children:[(0,a.jsx)("div",{className:(0,C.cn)("w-8 h-8 rounded-full flex items-center justify-center shrink-0",s),children:(0,a.jsx)(t,{className:"w-4 h-4"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("p",{className:"text-sm text-foreground",children:[(0,a.jsx)("span",{className:"font-medium",children:e.userName})," ",(e=>{switch(e.activityType){case"liked_track":return`liked "${e.activityData?.track_title||"a track"}"`;case"created_playlist":return`created playlist "${e.activityData?.playlist_name||"a playlist"}"`;case"followed_user":return`started following ${e.activityData?.following_name||"someone"}`;case"added_to_playlist":return`added a track to "${e.activityData?.playlist_name||"a playlist"}"`;default:return"did something"}})(e)]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-0.5",children:e.createdAt?(0,O.m)(new Date(e.createdAt),{addSuffix:!0}):"recently"})]})]},e.id)})})}var L=s(98500),M=s.n(L);function $({profile:e,stats:t}){let{setTheme:s,resolvedTheme:T}=(0,d.D)(),I=(0,o.useRouter)(),[D,E]=(0,w.useState)(!1),[C,O]=(0,w.useState)(!1),[L,$]=(0,w.useState)(T),[X,U]=(0,w.useState)(t),[V,R]=(0,w.useState)(!1),[Z,F]=(0,w.useState)(null),[J,q]=(0,w.useState)(null),W=(0,k.U)(),{toast:B}=(0,_.d)();(0,w.useEffect)(()=>{O(!0),$(T)},[T]),(0,w.useEffect)(()=>{e.id&&C&&((async()=>{try{R(!0);let[t,s]=await Promise.all([W.from("liked_songs").select("*",{count:"exact",head:!0}).eq("user_id",e.id),W.from("playlists").select("*",{count:"exact",head:!0}).eq("user_id",e.id)]);U({likedSongs:t.count||0,playlists:s.count||0})}catch(e){console.error("[Profile] Error loading stats:",e)}finally{R(!1)}})(),F((0,A.uL)()),(0,S.$I)().then(q))},[e.id,C]);let H=async()=>{try{E(!0),await W.auth.signOut(),B({title:"Logged out",description:"You have been logged out successfully"}),I.push("/auth/login")}catch(e){console.error("Logout error:",e),B({title:"Error",description:"Failed to logout",variant:"destructive"})}finally{E(!1)}};if(!C)return(0,a.jsxs)("div",{className:"space-y-8 animate-pulse",children:[(0,a.jsx)("div",{className:"h-32 bg-muted rounded-lg"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)("div",{className:"h-24 bg-muted rounded-lg"}),(0,a.jsx)("div",{className:"h-24 bg-muted rounded-lg"})]})]});let G=Z?(0,A.sH)(Z.xp,Z.level):0;return(0,a.jsxs)("div",{className:"pb-8 space-y-8",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center sm:items-start justify-between gap-6 p-6 sm:p-8 bg-gradient-to-br from-primary/10 via-transparent to-transparent rounded-xl border border-border/50",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-6 flex-1 text-center sm:text-left",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)(r.eu,{className:"h-24 sm:h-28 w-24 sm:w-28 border-2 border-primary/20",children:[(0,a.jsx)(r.BK,{src:e.avatarUrl,alt:e.displayName}),(0,a.jsx)(r.q5,{className:"text-2xl bg-primary/10 text-primary",children:e.displayName.charAt(0).toUpperCase()})]}),Z&&(0,a.jsx)("div",{className:"absolute -bottom-1 -right-1 w-8 h-8 rounded-full bg-primary flex items-center justify-center text-xs font-bold text-primary-foreground border-2 border-background",children:Z.level})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("h1",{className:"text-3xl sm:text-4xl font-bold mb-1 text-balance",children:e.displayName}),Z&&(0,a.jsxs)("p",{className:"text-sm text-primary font-medium mb-2",children:[(0,A.eI)(Z.level)," -- Level ",Z.level]}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm break-all",children:e.email}),Z&&(0,a.jsxs)("div",{className:"mt-3 max-w-xs",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[(0,a.jsxs)("span",{children:[Z.xp," XP"]}),(0,a.jsxs)("span",{children:[(0,A.$S)(Z.level)," XP"]})]}),(0,a.jsx)(n.k,{value:G,className:"h-1.5"})]})]})]}),(0,a.jsx)(l.$,{variant:"outline",size:"lg",onClick:()=>{let e="dark"===L?"light":"dark";$(e),s(e)},className:"rounded-full shrink-0 h-14 w-14",title:`Switch to ${"dark"===L?"light":"dark"} mode`,children:"dark"===L?(0,a.jsx)(m.A,{className:"w-6 h-6"}):(0,a.jsx)(u.A,{className:"w-6 h-6"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3",children:[(0,a.jsx)(P,{icon:x.A,label:"Liked Songs",value:V?"...":X.likedSongs.toString(),color:"text-red-500",bgColor:"bg-red-500/10"}),(0,a.jsx)(P,{icon:h.A,label:"Playlists",value:V?"...":X.playlists.toString(),color:"text-blue-500",bgColor:"bg-blue-500/10"}),(0,a.jsx)(P,{icon:g.A,label:"Day Streak",value:Z?.streak.toString()||"0",color:"text-orange-500",bgColor:"bg-orange-500/10"}),(0,a.jsx)(P,{icon:f.A,label:"Listening",value:J?(0,S.WD)(J.totalListeningTime):"0m",color:"text-primary",bgColor:"bg-primary/10"})]}),(0,a.jsxs)(c.tU,{defaultValue:"overview",className:"w-full",children:[(0,a.jsxs)(c.j7,{className:"bg-secondary/50 p-1 w-full sm:w-auto",children:[(0,a.jsxs)(c.Xi,{value:"overview",className:"data-[state=active]:bg-card gap-2 flex-1 sm:flex-none",children:[(0,a.jsx)(v.A,{className:"w-4 h-4"}),"Overview"]}),(0,a.jsxs)(c.Xi,{value:"achievements",className:"data-[state=active]:bg-card gap-2 flex-1 sm:flex-none",children:[(0,a.jsx)(p.A,{className:"w-4 h-4"}),"Achievements"]}),(0,a.jsxs)(c.Xi,{value:"activity",className:"data-[state=active]:bg-card gap-2 flex-1 sm:flex-none",children:[(0,a.jsx)(j.A,{className:"w-4 h-4"}),"Activity"]})]}),(0,a.jsxs)(c.av,{value:"overview",className:"mt-6 space-y-6",children:[J&&(0,a.jsxs)(i.Zp,{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"font-bold text-foreground flex items-center gap-2",children:[(0,a.jsx)(v.A,{className:"w-5 h-5 text-primary"}),"Listening Summary"]}),(0,a.jsx)(M(),{href:"/stats",children:(0,a.jsx)(l.$,{variant:"ghost",size:"sm",className:"text-muted-foreground",children:"View Details"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-foreground",children:J.totalTracks}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Tracks Played"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-foreground",children:J.totalArtists}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Artists"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-foreground",children:(0,S.WD)(J.thisWeekListeningTime)}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"This Week"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-foreground",children:(0,S.WD)(J.thisMonthListeningTime)}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"This Month"})]})]})]}),(0,a.jsxs)(i.Zp,{className:"p-6 border-border/50",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 pb-4 border-b border-border/50 mb-4",children:[(0,a.jsx)(y.A,{className:"w-5 h-5 text-primary"}),(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Settings"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Theme"}),(0,a.jsx)("span",{className:"text-sm font-medium capitalize",children:L||"system"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 hover:bg-secondary/50 rounded-lg transition-colors",children:[(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:"Account"}),(0,a.jsxs)("span",{className:"text-xs font-mono text-primary",children:[e.id.slice(0,8),"..."]})]})]}),(0,a.jsxs)(l.$,{variant:"destructive",className:"w-full mt-6",onClick:H,disabled:D,children:[(0,a.jsx)(b.A,{className:"w-4 h-4 mr-2"}),D?"Logging out...":"Logout"]})]})]}),(0,a.jsx)(c.av,{value:"achievements",className:"mt-6 space-y-6",children:Z&&Z.achievements.length>0?(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:Z.achievements.map(e=>(0,a.jsxs)(i.Zp,{className:"p-4 flex items-center gap-3 border-primary/20",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-lg bg-primary/20 flex items-center justify-center shrink-0",children:(0,a.jsx)(N.A,{className:"w-5 h-5 text-primary"})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-foreground",children:e.title}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.id))}):(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(p.A,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"No achievements yet"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Keep listening to unlock achievements"}),(0,a.jsx)(M(),{href:"/stats",children:(0,a.jsx)(l.$,{variant:"outline",className:"mt-4",children:"View All Achievements"})})]})}),(0,a.jsx)(c.av,{value:"activity",className:"mt-6",children:(0,a.jsxs)(i.Zp,{className:"p-6",children:[(0,a.jsxs)("h3",{className:"font-bold text-foreground mb-4 flex items-center gap-2",children:[(0,a.jsx)(j.A,{className:"w-5 h-5 text-primary"}),"Recent Activity"]}),(0,a.jsx)(z,{userId:e.id})]})})]})]})}function P({icon:e,label:t,value:s,color:r,bgColor:l}){return(0,a.jsxs)(i.Zp,{className:"p-4 text-center",children:[(0,a.jsx)("div",{className:`w-9 h-9 rounded-lg ${l} flex items-center justify-center mx-auto mb-2`,children:(0,a.jsx)(e,{className:`w-4 h-4 ${r}`})}),(0,a.jsx)("p",{className:"text-xl font-bold text-foreground",children:s}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:t})]})}},4474:(e,t,s)=>{"use strict";s.d(t,{$:()=>c});var a=s(95155);s(12115);var r=s(42442),i=s(18460),l=s(91337);let n=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function c({className:e,variant:t,size:s,asChild:i=!1,...c}){let d=i?r.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,l.cn)(n({variant:t,size:s,className:e})),...c})}},7236:(e,t,s)=>{"use strict";s.d(t,{N:()=>i,U:()=>r});var a=s(19338);function r(){return(0,a.createBrowserClient)("https://nzeqnvmepoykadilajud.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56ZXFudm1lcG95a2FkaWxhanVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5OTMzMDAsImV4cCI6MjA4NDU2OTMwMH0.igLBLX9XCMVkAthRm4T4pHiNU4iF9c5RoI2JGYHsPrI")}let i=r()},39013:(e,t,s)=>{Promise.resolve().then(s.bind(s,3582))},54614:(e,t,s)=>{"use strict";s.d(t,{$o:()=>n,ToastProvider:()=>c});var a=s(95155),r=s(12115);let i=new Map,l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)};default:return e}},n=r.createContext(void 0),c=({children:e})=>{let[t,s]=r.useReducer(l,{toasts:[]});return r.useEffect(()=>{t.toasts.forEach(e=>{!1===e.open&&((e,t)=>{if(i.has(e))return;let s=setTimeout(()=>{i.delete(e),t({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,s)})(e.id,s)})},[t.toasts]),(0,a.jsx)(n.Provider,{value:{state:t,dispatch:s},children:e})}},81890:(e,t,s)=>{"use strict";s.d(t,{d:()=>l});var a=s(12115),r=s(54614);let i=0;function l(){let e=a.useContext(r.$o);if(!e)throw Error("useToast must be used within a ToastProvider");let{state:t,dispatch:s}=e,l=a.useCallback(({...e})=>{let t=(i=(i+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>s({type:"DISMISS_TOAST",toastId:t});return s({type:"ADD_TOAST",toast:{...e,id:t,open:!0,onOpenChange:e=>{e||a()}}}),{id:t,dismiss:a}},[s]);return{...t,toast:l,dismiss:e=>s({type:"DISMISS_TOAST",toastId:e})}}},95885:(e,t,s)=>{"use strict";s.d(t,{BK:()=>n,eu:()=>l,q5:()=>c});var a=s(95155);s(12115);var r=s(5143),i=s(91337);function l({className:e,...t}){return(0,a.jsx)(r.bL,{"data-slot":"avatar",className:(0,i.cn)("relative flex size-8 shrink-0 overflow-hidden rounded-full",e),...t})}function n({className:e,...t}){return(0,a.jsx)(r._V,{"data-slot":"avatar-image",className:(0,i.cn)("aspect-square size-full",e),...t})}function c({className:e,...t}){return(0,a.jsx)(r.H4,{"data-slot":"avatar-fallback",className:(0,i.cn)("bg-muted flex size-full items-center justify-center rounded-full",e),...t})}}},e=>{e.O(0,[6679,9338,1300,8349,8500,4870,8351,8441,3794,7358],()=>e(e.s=39013)),_N_E=e.O()}]);