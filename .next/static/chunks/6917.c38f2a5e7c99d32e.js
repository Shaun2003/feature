"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6917],{7236:(t,e,o)=>{o.d(e,{N:()=>n,U:()=>a});var r=o(19338);function a(){return(0,r.createBrowserClient)("https://nzeqnvmepoykadilajud.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56ZXFudm1lcG95a2FkaWxhanVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5OTMzMDAsImV4cCI6MjA4NDU2OTMwMH0.igLBLX9XCMVkAthRm4T4pHiNU4iF9c5RoI2JGYHsPrI")}let n=a()},54614:(t,e,o)=>{o.d(e,{$o:()=>s,ToastProvider:()=>d});var r=o(95155),a=o(12115);let n=new Map,i=(t,e)=>{switch(e.type){case"ADD_TOAST":return{...t,toasts:[e.toast,...t.toasts].slice(0,1)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(t=>t.id===e.toast.id?{...t,...e.toast}:t)};case"DISMISS_TOAST":{let{toastId:o}=e;return{...t,toasts:t.toasts.map(t=>t.id===o||void 0===o?{...t,open:!1}:t)}}case"REMOVE_TOAST":if(void 0===e.toastId)return{...t,toasts:[]};return{...t,toasts:t.toasts.filter(t=>t.id!==e.toastId)};default:return t}},s=a.createContext(void 0),d=({children:t})=>{let[e,o]=a.useReducer(i,{toasts:[]});return a.useEffect(()=>{e.toasts.forEach(t=>{!1===t.open&&((t,e)=>{if(n.has(t))return;let o=setTimeout(()=>{n.delete(t),e({type:"REMOVE_TOAST",toastId:t})},1e6);n.set(t,o)})(t.id,o)})},[e.toasts]),(0,r.jsx)(s.Provider,{value:{state:e,dispatch:o},children:t})}},56995:(t,e,o)=>{o.d(e,{nL:()=>h,A1:()=>u,ZK:()=>w});var r=o(7236),a=o(43928);let n=(0,o(36228).UU)("https://nzeqnvmepoykadilajud.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56ZXFudm1lcG95a2FkaWxhanVkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5OTMzMDAsImV4cCI6MjA4NDU2OTMwMH0.igLBLX9XCMVkAthRm4T4pHiNU4iF9c5RoI2JGYHsPrI");async function i(t){let{data:{user:e}}=await n.auth.getUser();if(!e)throw Error("Not authenticated");let{error:o}=await n.from("liked_tracks").insert({user_id:e.id,...t});if(o)throw o}async function s(t){let{data:{user:e}}=await n.auth.getUser();if(!e)throw Error("Not authenticated");let{error:o}=await n.from("liked_tracks").delete().eq("user_id",e.id).eq("video_id",t);if(o)throw o}async function d(t){let{data:{user:e}}=await n.auth.getUser();if(!e)throw Error("Not authenticated");let{error:o}=await n.from("bookmarked_tracks").insert({user_id:e.id,...t});if(o)throw o}let l="pulse-sync-queue";function c(t,e,o,r){let a=function(){try{let t=localStorage.getItem(l);return t?JSON.parse(t):[]}catch(t){return console.error("Error reading offline queue:",t),[]}}(),n={id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,operation:t,table_name:e,video_id:r,data:o,created_at:Date.now(),synced:!1};return a.push(n),a.length>1e3&&a.shift(),localStorage.setItem(l,JSON.stringify(a)),n}async function u(t,e={}){if(e.skipSync)return;let{data:{user:o}}=await r.N.auth.getUser();if(!o)return void console.warn("User not authenticated, skipping backend sync");try{await i({video_id:t.id,title:t.title,artist:t.channelTitle,thumbnail:t.thumbnail,duration:(0,a.XB)(t.duration)})}catch(o){e.offline?(c("add_like","liked_tracks",{video_id:t.id,title:t.title,artist:t.channelTitle,thumbnail:t.thumbnail,duration:(0,a.XB)(t.duration)}),console.log("Queued like operation for sync")):console.error("Failed to sync like:",o)}}async function w(t,e={}){if(e.skipSync)return;let{data:{user:o}}=await r.N.auth.getUser();if(!o)return void console.warn("User not authenticated, skipping backend sync");try{await s(t)}catch(o){e.offline?(c("remove_like","liked_tracks",{video_id:t},t),console.log("Queued unlike operation for sync")):console.error("Failed to sync unlike:",o)}}async function h(t,e={}){if(e.skipSync)return;let{data:{user:o}}=await r.N.auth.getUser();if(!o)return void console.warn("User not authenticated, skipping backend sync");try{await d({video_id:t.id,title:t.title,artist:t.channelTitle,thumbnail:t.thumbnail,duration:(0,a.XB)(t.duration)})}catch(o){e.offline?(c("add_bookmark","bookmarked_tracks",{video_id:t.id,title:t.title,artist:t.channelTitle,thumbnail:t.thumbnail,duration:(0,a.XB)(t.duration)}),console.log("Queued bookmark operation for sync")):console.error("Failed to sync bookmark:",o)}}},81890:(t,e,o)=>{o.d(e,{d:()=>i});var r=o(12115),a=o(54614);let n=0;function i(){let t=r.useContext(a.$o);if(!t)throw Error("useToast must be used within a ToastProvider");let{state:e,dispatch:o}=t,i=r.useCallback(({...t})=>{let e=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),r=()=>o({type:"DISMISS_TOAST",toastId:e});return o({type:"ADD_TOAST",toast:{...t,id:e,open:!0,onOpenChange:t=>{t||r()}}}),{id:e,dismiss:r}},[o]);return{...e,toast:i,dismiss:t=>o({type:"DISMISS_TOAST",toastId:t})}}},94674:(t,e,o)=>{o.d(e,{BB:()=>l,UB:()=>i,WR:()=>s,hS:()=>d});var r=o(43928);let a=null;async function n(){return a||new Promise((t,e)=>{let o=indexedDB.open("pulse-music-db",2);o.onerror=()=>e(o.error),o.onsuccess=()=>{t(a=o.result)}})}async function i(t,e){let o=(await n()).transaction("downloads","readwrite").objectStore("downloads"),r={...t,downloadedAt:Date.now(),downloadStatus:"downloading",downloadProgress:0};o.put(r);try{e?.(10),t.id,r.audioUrl=`https://www.youtube.com/watch?v=${t.id}`,r.downloadStatus="completed",r.downloadProgress=100,e?.(50),o.put(r),e?.(100),console.log(`[v0] Downloaded track: ${t.title}`)}catch(e){throw console.error(`[v0] Download error for ${t.id}:`,e),r.downloadStatus="failed",o.put(r),Error(`Failed to download ${t.title}`)}}async function s(){let t=(await n()).transaction("downloads","readonly").objectStore("downloads").index("downloadStatus");return new Promise((e,o)=>{let a=t.openCursor(IDBKeyRange.only("completed"),"prev"),n=[];a.onsuccess=t=>{let o=t.target.result;if(o){let t=o.value;(0,r.K0)(t.id)?n.push(t):console.warn("[v0] Skipping downloaded track with invalid ID:",t.id),o.continue()}else e(n)},a.onerror=()=>o(a.error)})}async function d(t){let e=(await n()).transaction("downloads","readonly").objectStore("downloads");return new Promise((o,r)=>{let a=e.get(t);a.onsuccess=()=>{let t=a.result;o(!!t&&"completed"===t.downloadStatus)},a.onerror=()=>r(a.error)})}async function l(t){let e=(await n()).transaction("downloads","readwrite").objectStore("downloads");return new Promise((o,r)=>{let a=e.delete(t);a.onsuccess=()=>{console.log(`[v0] Deleted downloaded track: ${t}`),o()},a.onerror=()=>{console.error("[v0] Failed to delete downloaded track:",a.error),r(a.error)}})}}}]);