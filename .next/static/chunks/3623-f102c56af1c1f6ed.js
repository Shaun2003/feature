"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3623],{23623:(e,t,i)=>{i.d(t,{BC:()=>d,W5:()=>l,aq:()=>s,cZ:()=>u,r9:()=>o,sr:()=>c});var r=i(43928);let n=null;async function a(){return n||new Promise((e,t)=>{let i=indexedDB.open("pulse-music-db",2);i.onerror=()=>t(i.error),i.onsuccess=()=>{e(n=i.result)},i.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains("tracks")){let e=t.createObjectStore("tracks",{keyPath:"id"});e.createIndex("savedAt","savedAt",{unique:!1}),e.createIndex("playCount","playCount",{unique:!1})}if(t.objectStoreNames.contains("playlists")||t.createObjectStore("playlists",{keyPath:"id"}).createIndex("name","name",{unique:!1}),t.objectStoreNames.contains("recentlyPlayed")||t.createObjectStore("recentlyPlayed",{keyPath:"id"}).createIndex("playedAt","playedAt",{unique:!1}),t.objectStoreNames.contains("likedTracks")||t.createObjectStore("likedTracks",{keyPath:"id"}),!t.objectStoreNames.contains("downloads")){let e=t.createObjectStore("downloads",{keyPath:"id"});e.createIndex("downloadedAt","downloadedAt",{unique:!1}),e.createIndex("downloadStatus","downloadStatus",{unique:!1})}t.objectStoreNames.contains("albums")||t.createObjectStore("albums",{keyPath:"id"}).createIndex("savedAt","savedAt",{unique:!1})}})}async function l(e){let t=(await a()).transaction("recentlyPlayed","readwrite").objectStore("recentlyPlayed");t.put({...e,playedAt:Date.now()});let i=t.count();i.onsuccess=()=>{if(i.result>50){let e=t.index("playedAt").openCursor(),r=i.result-50;e.onsuccess=e=>{let t=e.target.result;t&&r>0&&(t.delete(),r--,t.continue())}}}}async function s(){let e=(await a()).transaction("recentlyPlayed","readonly").objectStore("recentlyPlayed").index("playedAt");return new Promise((t,i)=>{let n=e.openCursor(null,"prev"),a=[];n.onsuccess=e=>{let i=e.target.result;if(i&&a.length<20){let e=i.value;(0,r.K0)(e.id)?a.push(e):console.warn("[v0] Skipping recently played track with invalid ID:",e.id),i.continue()}else t(a)},n.onerror=()=>i(n.error)})}async function o(e){(await a()).transaction("likedTracks","readwrite").objectStore("likedTracks").put({...e,likedAt:Date.now()})}async function c(e){(await a()).transaction("likedTracks","readwrite").objectStore("likedTracks").delete(e)}async function u(){let e=(await a()).transaction("likedTracks","readonly").objectStore("likedTracks");return new Promise((t,i)=>{let n=e.getAll();n.onsuccess=()=>{t(n.result.filter(e=>!!(0,r.K0)(e.id)||(console.warn("[v0] Skipping liked track with invalid ID:",e.id),!1)))},n.onerror=()=>i(n.error)})}async function d(e){let t=(await a()).transaction("likedTracks","readonly").objectStore("likedTracks");return new Promise((i,r)=>{let n=t.get(e);n.onsuccess=()=>i(!!n.result),n.onerror=()=>r(n.error)})}},43928:(e,t,i)=>{i.d(t,{XB:()=>y,getPlaylistItems:()=>d,Pd:()=>u,K0:()=>o,eZ:()=>c});class r{get(e){let t=this.cache.get(e);return t?Date.now()-t.timestamp>t.ttl?(this.cache.delete(e),null):t.data:null}set(e,t,i=this.DEFAULT_TTL){this.cache.set(e,{data:t,timestamp:Date.now(),ttl:i})}clear(){this.cache.clear()}clearOldEntries(e=this.DEFAULT_TTL){let t=Date.now();for(let[i,r]of this.cache.entries())t-r.timestamp>e&&this.cache.delete(i)}constructor(){this.cache=new Map,this.DEFAULT_TTL=3e5}}let n=new r;function a(e,t){let i=new URLSearchParams(Object.entries(t).reduce((e,[t,i])=>(null!=i&&(e[t]=String(i)),e),{})).toString();return`${e}?${i}`}let l="AIzaSyCpbcqf4WZxq7UVJUZ-XVO7qTFpBeJE0kI",s="https://www.googleapis.com/youtube/v3";function o(e){if(!e||"string"!=typeof e)return!1;let t=e.trim();return/^[a-zA-Z0-9_-]{11}$/.test(t)}async function c(e,t){if(!l)return console.error("[v0] YouTube API key not configured"),{videos:[],playlists:[]};try{let i=a("search-youtube",{query:e});if(!t){let t=n.get(i);if(t)return console.log("[v0] Search cache hit:",e),t}let r=new URLSearchParams({part:"snippet",q:`${e} official audio`,type:"video,playlist",maxResults:"20",key:l});t&&r.append("pageToken",t);let c=await fetch(`${s}/search?${r.toString()}`);if(!c.ok)throw Error(`YouTube search failed: ${c.status}`);let u=await c.json(),d=u.items.filter(e=>"youtube#video"===e.id.kind),y=u.items.filter(e=>"youtube#playlist"===e.id.kind),f=d.map(e=>e.id.videoId).join(","),m=y.map(e=>({id:e.id.playlistId,title:e.snippet.title,description:e.snippet.description,thumbnail:e.snippet.thumbnails.high?.url||"",channelTitle:e.snippet.channelTitle})),k=[];if(f){let e=await fetch(`${s}/videos?part=contentDetails,snippet&id=${f}&key=${l}`);if(!e.ok)throw Error(`YouTube details failed: ${e.status}`);let t=(await e.json()).items.map(e=>{if(!o(e.id))return console.warn("[v0] Skipping video with invalid ID format:",e.id),null;let t=e.snippet.title,i=e.snippet.channelTitle,r=i;return t.includes(" - ")?r=t.split(" - ")[0].trim():t.includes(" | ")&&(r=t.split(" | ")[0].trim()),{id:e.id,title:p(t),artist:r,thumbnail:e.snippet.thumbnails.high?.url||"",duration:h(e.contentDetails.duration),channelTitle:i}});k.push(...t.filter(e=>null!==e))}let w={videos:k,playlists:m,nextPageToken:u.nextPageToken};return t||n.set(i,w),w}catch(e){return console.error("[v0] YouTube search error:",e),{videos:[],playlists:[]}}}async function u(){if(!l)return[];try{let e="trending-music",t=n.get(e);if(t)return console.log("[v0] Trending cache hit"),t;let i=await fetch(`${s}/videos?part=snippet,contentDetails&chart=mostPopular&regionCode=US&videoCategoryId=10&maxResults=20&key=${l}`);if(!i.ok)throw Error(`YouTube trending failed: ${i.status}`);let r=(await i.json()).items.map(e=>{let t=e.snippet.title,i=e.snippet.channelTitle,r=i;return t.includes(" - ")&&(r=t.split(" - ")[0].trim()),{id:e.id,title:p(t),artist:r,thumbnail:e.snippet.thumbnails.high?.url||"",duration:h(e.contentDetails.duration),channelTitle:i}});return n.set(e,r,36e5),r}catch(e){return console.error("[v0] YouTube trending error:",e),[]}}async function d(e,t=20){if(!l)return[];try{let i=a("playlist-items",{playlistId:e,maxResults:t}),r=n.get(i);if(r)return console.log("[v0] Playlist cache hit:",e),r;let c=await fetch(`${s}/playlistItems?part=snippet,contentDetails&playlistId=${e}&maxResults=${t}&key=${l}`);if(!c.ok)throw Error(`YouTube playlist failed: ${c.status}`);let u=(await c.json()).items.map(e=>e.contentDetails.videoId).join(",");if(!u)return[];let d=await fetch(`${s}/videos?part=contentDetails,snippet&id=${u}&key=${l}`);if(!d.ok)throw Error(`YouTube video details failed: ${d.status}`);return(await d.json()).items.map(e=>{if(!o(e.id))return console.warn("[v0] Skipping playlist item with invalid ID format:",e.id),null;let t=e.snippet.title,i=e.snippet.channelTitle,r=i;return t.includes(" - ")&&(r=t.split(" - ")[0].trim()),{id:e.id,title:p(t),artist:r,thumbnail:e.snippet.thumbnails.high?.url||"",duration:h(e.contentDetails.duration),channelTitle:i}}).filter(e=>null!==e)}catch(e){return console.error("[v0] YouTube playlist error:",e),[]}}function p(e){return e.replace(/\(Official\s*(Music\s*)?Video\)/gi,"").replace(/\[Official\s*(Music\s*)?Video\]/gi,"").replace(/\(Official\s*Audio\)/gi,"").replace(/\[Official\s*Audio\]/gi,"").replace(/\(Lyrics?\)/gi,"").replace(/\[Lyrics?\]/gi,"").replace(/\(Audio\)/gi,"").replace(/\[Audio\]/gi,"").replace(/\|.*$/g,"").replace(/\s+-\s+[^-]+$/,"").trim()}function h(e){let t=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);if(!t)return"0:00";let i=parseInt(t[1]||"0"),r=parseInt(t[2]||"0"),n=parseInt(t[3]||"0");return i>0?`${i}:${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`:`${r}:${n.toString().padStart(2,"0")}`}function y(e){let t=e.split(":").map(Number);return 3===t.length?3600*t[0]+60*t[1]+t[2]:60*t[0]+(t[1]||0)}}}]);